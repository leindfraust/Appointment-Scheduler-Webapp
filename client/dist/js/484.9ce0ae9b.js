"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[484],{3823:function(t,e,s){s.r(e),s.d(e,{default:function(){return xt}});var a=s(6252),i=s(3577),l=s(9963);const o={class:"main-doctor"},c={class:"columns"},n={class:"column is-2"},r={class:"column"},d=(0,a._)("div",{class:"modal-background"},null,-1),h={class:"modal-content"},g={class:"section box"},u={class:"field is-horizontal"},p={class:"field-body"},m={class:"field"},_={class:"control"},b=(0,a._)("label",{class:"label"},"From:",-1),f=["value"],w={class:"field"},v={class:"control"},y=(0,a._)("div",{class:"label"},"To(Patient):",-1),D=["value"],k={class:"field"},M={class:"control"},N=(0,a._)("label",{class:"label"},"Attach an image(optional):",-1),P={class:"field"},C={class:"control"},I=(0,a._)("label",{class:"label"},"Subject: ",-1),x={class:"field"},S={class:"control"},Z=(0,a._)("label",{class:"label"},"Message:",-1),z={class:"field"},H={class:"control has-text-right"},A=["disabled"],$={key:0,class:"has-text-success"},B=(0,a._)("p",{class:"subtitle"},"Messaging History",-1),j={key:1,class:"container"},L=(0,a._)("p",{class:"subtitle is-size-6 has-text-right"},"Are you sure you want to delete all messages?",-1),T={class:"buttons is-right"},U={key:2},F={class:"notification",style:{margin:"5%"}},q={class:"content"},Y={key:0},O={class:"image is-square"},R=["src"],E={class:"has-text-centered"},K=["href"],V=(0,a._)("br",null,null,-1),W=["onClick"],G={key:3},J=(0,a._)("p",null,"No past messages yet.",-1),Q=[J],X={class:"section"},tt={class:"container is-widescreen is-fullhd",style:{padding:"15"}},et=(0,a._)("h1",{class:"title"}," APPOINTMENT HISTORY ",-1),st={key:0,class:"field"},at={class:"control"},it={key:1,class:"container"},lt={class:"subtitle has-text-black"},ot={class:"table-container"},ct={class:"table is-fullwidth"},nt=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",{class:"has-text-black-ter"},"Controls"),(0,a._)("th",{class:"has-text-black-ter"},"Reference ID"),(0,a._)("th",{class:"has-text-black-ter"},"Priority No."),(0,a._)("th",{class:"has-text-black-ter"},"Hospital Appointed"),(0,a._)("th",{class:"has-text-black-ter"},"First Name"),(0,a._)("th",{class:"has-text-black-ter"},"Last Name"),(0,a._)("th",{class:"has-text-black-ter"},"Contact Number"),(0,a._)("th",{class:"has-text-black-ter"},"Birthday"),(0,a._)("th",{class:"has-text-black-ter"},"Symptoms/Comments")])],-1),rt=["onClick"],dt={class:"has-text-black-ter"},ht={class:"has-text-black-ter"},gt={class:"has-text-black-ter"},ut={class:"has-text-black-ter"},pt={class:"has-text-black-ter"},mt={class:"has-text-black-ter"},_t={class:"has-text-black-ter"},bt={class:"has-text-black-ter",style:{"white-space":"pre-wrap"}},ft={key:2,class:"notification is-info"};function wt(t,e,s,J,wt,vt){const yt=(0,a.up)("DoctorMenu"),Dt=(0,a.up)("CatchError");return(0,a.wg)(),(0,a.iD)("div",o,[(0,a._)("div",c,[(0,a._)("div",n,[(0,a.Wm)(yt)]),(0,a._)("div",r,[(0,a._)("div",{class:(0,i.C_)(["modal",{"is-active":wt.isActiveModal}])},[d,(0,a._)("div",h,[(0,a._)("div",g,[(0,a._)("div",u,[(0,a._)("div",p,[(0,a._)("div",m,[(0,a._)("div",_,[b,(0,a._)("input",{class:"input",type:"text",value:"Dr. "+wt.doctorName,disabled:""},null,8,f)])]),(0,a._)("div",w,[(0,a._)("div",v,[y,(0,a._)("input",{class:"input",type:"text",value:wt.selectedPatient,disabled:""},null,8,D)])])])]),(0,a._)("div",k,[(0,a._)("div",M,[N,(0,a._)("input",{class:"input",type:"file",onChange:e[0]||(e[0]=t=>vt.handleFile(t))},null,32)])]),(0,a._)("div",P,[(0,a._)("div",C,[I,(0,a.wy)((0,a._)("input",{class:"input",type:"text",placeholder:"Subject","onUpdate:modelValue":e[1]||(e[1]=t=>wt.titleMsg=t)},null,512),[[l.nr,wt.titleMsg]])])]),(0,a._)("div",x,[(0,a._)("div",S,[Z,(0,a.wy)((0,a._)("textarea",{class:"textarea",placeholder:"Message","onUpdate:modelValue":e[2]||(e[2]=t=>wt.noticeMsg=t)},"default value",512),[[l.nr,wt.noticeMsg]])])]),(0,a._)("div",z,[(0,a._)("div",H,[(0,a._)("button",{class:(0,i.C_)(["button is-primary",{"is-loading":wt.loadingButton}]),onClick:e[3]||(e[3]=(...t)=>vt.sendNotif&&vt.sendNotif(...t)),disabled:""==wt.selectedPatient||""==wt.noticeMsg},"Send",10,A)])]),wt.notificationSent?((0,a.wg)(),(0,a.iD)("p",$,[(0,a.Uk)(" A message has been sent to "),(0,a._)("b",null,(0,i.zw)(wt.messageSuccessSelectedPatient),1),(0,a.Uk)(". ")])):(0,a.kq)("",!0),(0,a._)("a",{class:"button is-size-6 has-text-danger is-pulled-right",onClick:e[4]||(e[4]=t=>wt.clearMsgPrompt=!0)},"Clear message history"),B,wt.clearMsgPrompt?((0,a.wg)(),(0,a.iD)("div",j,[L,(0,a._)("div",T,[(0,a._)("button",{class:"button",onClick:e[5]||(e[5]=(...t)=>vt.clearNotif&&vt.clearNotif(...t))},"Yes"),(0,a._)("button",{class:"button",onClick:e[6]||(e[6]=t=>wt.clearMsgPrompt=!1)},"No")])])):(0,a.kq)("",!0),0!==Object.keys(wt.messageHistory).length?((0,a.wg)(),(0,a.iD)("div",U,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(wt.messageHistory,((e,s)=>((0,a.wg)(),(0,a.iD)("div",{class:"container",key:s},[(0,a._)("div",F,[(0,a._)("div",q,[(0,a._)("p",null,"To: "+(0,i.zw)(e.to),1),(0,a._)("p",null,"Subject: "+(0,i.zw)(e.subject),1),(0,a._)("p",null,"Message: "+(0,i.zw)(e.message),1),e.id?((0,a.wg)(),(0,a.iD)("div",Y,[(0,a._)("figure",O,[(0,a._)("img",{loading:"lazy",src:`https://res.cloudinary.com/leindfraust/image/upload/v1/assets/patientimgmsg/doctorCopy/${t.$store.state.doctorID+e.id}.jpg`},null,8,R)]),(0,a._)("div",E,[(0,a._)("a",{href:`https://res.cloudinary.com/leindfraust/image/upload/v1/assets/patientimgmsg/doctorCopy/${t.$store.state.doctorID+e.id}.jpg`,class:"button",download:""},"Download File",8,K)])])):(0,a.kq)("",!0),V,(0,a._)("p",null,"Date: "+(0,i.zw)(new Date(e.date).toLocaleString()),1)]),(0,a._)("button",{class:"delete",onClick:t=>vt.deleteNotif(e)},null,8,W)])])))),128))])):((0,a.wg)(),(0,a.iD)("div",G,Q))])]),(0,a._)("button",{class:"modal-close is-large","aria-label":"close",onClick:e[7]||(e[7]=(...t)=>vt.sendNotifInactive&&vt.sendNotifInactive(...t))})],2),(0,a._)("section",X,[(0,a.Wm)(Dt,{"err-msg":wt.errMsg},null,8,["err-msg"]),(0,a._)("div",tt,[et,0!==wt.appointmentSched.length?((0,a.wg)(),(0,a.iD)("div",st,[(0,a._)("div",at,[(0,a.wy)((0,a._)("input",{class:"input",type:"text",style:{width:"50% !important"},"onUpdate:modelValue":e[8]||(e[8]=t=>wt.searchBar=t),placeholder:"Search..."},null,512),[[l.nr,wt.searchBar]])])])):(0,a.kq)("",!0),0!==Object.keys(vt.appointmentSchedules).length?((0,a.wg)(),(0,a.iD)("div",it,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(vt.appointmentSchedules,((t,e)=>((0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["box",{"is-hidden":new Date(e).toDateString()==(new Date).toDateString()}]),key:e},[(0,a._)("h1",lt,"Schedule: "+(0,i.zw)(new Date(e).toDateString()),1),(0,a._)("div",ot,[(0,a._)("table",ct,[nt,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:t._id},[(0,a._)("button",{class:"button is-info is-light",onClick:e=>vt.sendNotifActive(t.patientID,t.firstName,t.lastName)},"Send a notification",8,rt),(0,a._)("th",dt,(0,i.zw)(t.referenceID),1),(0,a._)("th",ht,(0,i.zw)(t.priorityNum),1),(0,a._)("th",gt,(0,i.zw)(t.hospital),1),(0,a._)("td",ut,(0,i.zw)(t.firstName),1),(0,a._)("td",pt,(0,i.zw)(t.lastName),1),(0,a._)("td",mt,(0,i.zw)(t.contactNum),1),(0,a._)("td",_t,(0,i.zw)(t.birthDay),1),(0,a._)("td",bt,(0,i.zw)(t.comments),1)])))),128))])])])],2)))),128))])):((0,a.wg)(),(0,a.iD)("div",ft,"No previous appointments."))])])])])])}var vt=s(196),yt=s(7739),Dt=s.n(yt),kt=s(7787),Mt=s(9226),Nt=s(4058),Pt={name:"PatientLogs",components:{DoctorMenu:Mt.Z,CatchError:kt.Z},async mounted(){await vt.ZP.post("/api/appointmentList/doctors",{id:this.$store.state.doctorID,ongoing:!1}).then((t=>this.appointmentSched=t.data)),await vt.ZP.get("/session/doctor").then((t=>this.doctorName=t.data.fullname)),await vt.ZP.get("/session/doctor").then((t=>this.messageHistory=t.data.messageHistory.reverse()))},data(){return{errMsg:"",clearMsgPrompt:!1,loadingButton:!1,searchBar:"",appointmentSched:[],alias:this.$store.state.alias,file:null,isActiveModal:!1,selectedPatient:"",messageSuccessSelectedPatient:"",refID:"",doctorName:"",titleMsg:"",noticeMsg:"Dear",notificationSent:!1,messageHistory:[]}},computed:{appointmentSchedules(){return!!this.appointmentSched&&Dt()(this.appointmentSched.filter((t=>t.firstName.toLowerCase().includes(this.searchBar.toLowerCase())||t.lastName.toLowerCase().includes(this.searchBar.toLowerCase())||t.referenceID.toLowerCase().includes(this.searchBar.toLowerCase()))).sort(((t,e)=>new Date(e.schedule[0].date).getTime()-new Date(t.schedule[0].date).getTime())),"schedule[0].date")}},methods:{sendNotifActive(t,e,s){this.isActiveModal=!0,this.selectedPatient=e+" "+s,this.noticeMsg=`Dear Ms/Mr. ${this.selectedPatient},`,Nt.Z.connect(),Nt.Z.emit("join room",t)},sendNotifInactive(){this.isActiveModal=!1,this.selectedPatient="",Nt.Z.disconnect()},generateRefID(){let t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=e.length;for(let a=0;a<12;a++)t+=e.charAt(Math.floor(Math.random()*s));this.refID=t},async sendNotif(){if(this.loadingButton=!0,this.file){this.generateRefID();const t=new FormData;t.append("id",this.refID),t.append("doctorID",this.$store.state.doctorID),t.append("imgFile",this.file),await vt.ZP.post("/api/imgUploadImgMsg",t,{headers:{"Content-Type":"multipart/form-data"}})}else this.refID=null;let t;this.messageSuccessSelectedPatient=this.selectedPatient,Nt.Z.emit("message",this.refID,this.titleMsg,this.noticeMsg,this.doctorName,new Date),await vt.ZP.post("/api/pushMsg",{id:this.$store.state.doctorID,message:{id:this.refID,to:this.selectedPatient,subject:this.titleMsg,message:this.noticeMsg,date:new Date}}).then((e=>t=e.data)).catch((t=>this.errMsg=t)),await vt.ZP.put("/session/doctor",{messageHistory:t}),this.messageHistory=t.reverse(),this.noticeMsg="",this.notificationSent=!0,this.loadingButton=!1},async deleteNotif(t){let e;try{await vt.ZP.post("/api/imgUploadImgMsgDeleteDoctor",{doctorID:"assets/patientimgmsg/doctorCopy/"+this.$store.state.doctorID,id:t.id}),await vt.ZP.post("/api/pullMsg",{id:this.$store.state.doctorID,message:t}).then((t=>e=t.data)).catch((t=>{this.errMsg=t})),await vt.ZP.put("/session/doctor",{messageHistory:e})}catch(s){this.errMsg=s}this.messageHistory=e.reverse()},async clearNotif(){try{await vt.ZP.post("/api/imgUploadImgMsgClearDoctor",{doctorID:this.$store.state.doctorID}),await vt.ZP.post("/api/clearMsg",{id:this.$store.state.doctorID}).then((t=>this.messageHistory=t.data)).catch((t=>this.errMsg=t)),await vt.ZP.put("/session/doctor",{messageHistory:this.messageHistory})}catch(t){this.errMsg=t}this.clearMsgPrompt=!1},handleFile(t){this.file=t.target.files[0]}}},Ct=s(3744);const It=(0,Ct.Z)(Pt,[["render",wt]]);var xt=It}}]);
//# sourceMappingURL=484.9ce0ae9b.js.map