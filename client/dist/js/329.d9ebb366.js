"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[329],{6416:function(t,e,i){i.r(e),i.d(e,{default:function(){return vt}});var a=i(6252),s=i(3577),l=i(9963);const n=t=>((0,a.dD)("data-v-47a13b93"),t=t(),(0,a.Cn)(),t),o={class:"section"},c={key:0,class:"notification is-warning"},d=n((()=>(0,a._)("div",{class:"modal-background"},null,-1))),r=n((()=>(0,a._)("div",{class:"modal-content",style:{overflow:"hidden"}},[(0,a._)("div",{class:"loader",style:{margin:"auto"}})],-1))),h=[d,r],p=n((()=>(0,a._)("div",{class:"modal-background"},null,-1))),u={class:"modal-content box"},m={class:"section"},y=n((()=>(0,a._)("div",{class:"notification is-info"},"This schedule requires you to pay first before continuing!",-1))),g={class:"buttons is-centered"},_={class:"columns registration-form",style:{width:"75%",margin:"auto"}},b={class:"column"},f=n((()=>(0,a._)("div",{class:"block"},"To book your appointment, we have to verify a few details.",-1))),v={class:"field is-horizontal"},k={class:"field-body"},w={class:"field"},D=n((()=>(0,a._)("label",{class:"label"},"First name",-1))),C={class:"control"},N={class:"field"},S=n((()=>(0,a._)("label",{class:"label"},"Last Name",-1))),x={class:"control"},A={class:"field is-horizontal"},Z={class:"field-body"},I={class:"field"},F=n((()=>(0,a._)("label",{class:"label"},"Contact Number:",-1))),L={class:"control"},P={class:"field"},U=n((()=>(0,a._)("label",{class:"label"},"Birthday",-1))),T={class:"control"},z={class:"is-block"},V=["onClick"],q=["value"],R={class:"field"},E={class:"control"},M=n((()=>(0,a._)("label",{class:"label"},"Current Address",-1))),B=["value"],H={class:"field"},W=n((()=>(0,a._)("label",{class:"label"},"Reason for your visit:",-1))),Y={class:"column",style:{position:"relative"}},$={class:"field"},K=n((()=>(0,a._)("h1",{class:"subtitle is-5 has-text-black has-text-weight-bold"},"Pick your preferred schedule: ",-1))),Q=n((()=>(0,a._)("div",{class:"block"},null,-1))),j={class:"controls"},G={class:"radio"},J=["onClick"],O={class:"subtitle is-6 has-text-weight-semibold"},X=n((()=>(0,a._)("br",null,null,-1))),tt={class:"has-text-black"},et={style:{"pointer-events":"none"},class:"button statusSched"},it={key:0,class:"has-text-success"},at={key:1,class:"has-text-danger"},st={key:0,class:"block has-text-centered"},lt=n((()=>(0,a._)("hr",null,null,-1))),nt=n((()=>(0,a._)("h1",{class:"subtitle is-5 has-text-black has-text-weight-bold has-text-left"},"Let the doctor know what are you appointing for: ",-1))),ot={class:"select"},ct=["value"],dt={class:"block has-text-centered"},rt=["disabled"];function ht(t,e,i,n,d,r){const ht=(0,a.up)("NavigationTab"),pt=(0,a.up)("CatchError"),ut=(0,a.up)("v-date-picker");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(ht),(0,a._)("section",o,[(0,a.Wm)(pt,{"err-msg":d.errMsg},null,8,["err-msg"]),d.paymentFailed?((0,a.wg)(),(0,a.iD)("div",c,"Payment transaction failed. Please try again.")):(0,a.kq)("",!0),(0,a._)("div",{class:(0,s.C_)(["modal",{"is-active":d.isLoading}])},h,2),(0,a._)("div",{class:(0,s.C_)(["modal",{"is-active":d.paymentFirstToggle}])},[p,(0,a._)("div",u,[(0,a._)("section",m,[y,(0,a._)("div",g,[(0,a._)("button",{class:"button",onClick:e[0]||(e[0]=(...t)=>r.reloadPage&&r.reloadPage(...t))},"Cancel"),(0,a._)("button",{class:"button is-info",onClick:e[1]||(e[1]=t=>d.paymentFirstToggle=!1)},"Confirm")])])])],2),(0,a._)("div",_,[(0,a._)("div",b,[(0,a._)("form",null,[f,(0,a._)("div",v,[(0,a._)("div",k,[(0,a._)("div",w,[D,(0,a._)("div",C,[(0,a.wy)((0,a._)("input",{class:"input",type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>d.firstName=t),placeholder:"First Name",required:""},null,512),[[l.nr,d.firstName]])])]),(0,a._)("div",N,[S,(0,a._)("div",x,[(0,a.wy)((0,a._)("input",{class:"input",type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>d.lastName=t),placeholder:"Last Name",required:""},null,512),[[l.nr,d.lastName]])])])])]),(0,a._)("div",A,[(0,a._)("div",Z,[(0,a._)("div",I,[F,(0,a._)("div",L,[(0,a.wy)((0,a._)("input",{class:"input",type:"number","onUpdate:modelValue":e[4]||(e[4]=t=>d.contactNum=t),placeholder:"Contact Number",required:""},null,512),[[l.nr,d.contactNum]])])]),(0,a._)("div",P,[U,(0,a._)("div",T,[(0,a.Wm)(ut,{class:"block",modelValue:d.birthDay,"onUpdate:modelValue":e[5]||(e[5]=t=>d.birthDay=t)},{default:(0,a.w5)((({inputValue:t,togglePopover:e})=>[(0,a._)("div",z,[(0,a._)("a",{style:{margin:"auto"},onClick:t=>e()},[(0,a._)("input",{style:{cursor:"pointer"},value:t,class:"input",readonly:""},null,8,q)],8,V)])])),_:1},8,["modelValue"])])])])]),(0,a._)("div",R,[(0,a._)("div",E,[M,(0,a._)("input",{class:"input",type:"text",value:d.currentAddress},null,8,B)])]),(0,a._)("div",H,[W,(0,a.wy)((0,a._)("textarea",{class:"textarea",style:{"white-space":"pre-wrap"},"onUpdate:modelValue":e[6]||(e[6]=t=>d.comments=t),placeholder:"Your symptoms, general well being etc...",required:""},null,512),[[l.nr,d.comments]])])])]),(0,a._)("div",Y,[(0,a._)("form",$,[K,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(d.doctorSched,((t,e)=>((0,a.wg)(),(0,a.iD)("div",{key:t.id,style:{width:"75%",margin:"auto"}},[Q,(0,a._)("div",j,[(0,a._)("label",G,[(0,a._)("input",{type:"radio",class:"radioSched",name:"schedule",onClick:i=>r.pickSched(e,t,t.prefix,t.appointmentCategories,t.paymentFirst,t.paymentAmount)},null,8,J),(0,a._)("span",O,"Â "+(0,s.zw)(new Date(t.date).toDateString()),1),X,(0,a._)("span",tt,(0,s.zw)(t.timeStart)+" - "+(0,s.zw)(t.timeEnd),1)]),(0,a._)("a",et,[d.schedAvailability?((0,a.wg)(),(0,a.iD)("span",it,"Available")):((0,a.wg)(),(0,a.iD)("span",at,"Unavailable"))])])])))),128))]),0!==d.appointmentCategories.length?((0,a.wg)(),(0,a.iD)("div",st,[lt,nt,(0,a._)("div",ot,[(0,a.wy)((0,a._)("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>d.appointmentCategory=t)},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(d.appointmentCategories,(t=>((0,a.wg)(),(0,a.iD)("option",{key:t,value:t},(0,s.zw)(t),9,ct)))),128))],512),[[l.bM,d.appointmentCategory]])])])):(0,a.kq)("",!0),(0,a._)("div",dt,[(0,a._)("button",{type:"button",class:"button is-info",disabled:null==d.comments||null==d.schedule||""==d.firstName||""==d.lastName||null==d.birthDay||""==d.contactNum||""==d.comments||""==d.currentAddress,onClick:e[8]||(e[8]=(...t)=>r.appoint&&r.appoint(...t))},"Submit appointment",8,rt)])])])])],64)}var pt=i(594),ut=i(4239),mt=i(4172),yt=i(7787),gt=i(3343),_t={name:"RegForm",components:{NavigationTab:mt.Z,CatchError:yt.Z},data(){return{checkPatientRecord:null,patient:null,doctorSched:ut.Z.state.doctorDetails.schedule,firstName:null,lastName:null,birthDay:null,comments:null,contactNum:null,schedule:null,currentAddress:null,priorityNum:null,patientsAppointed:null,doctorDetails:ut.Z.state.doctorDetails,pickedSpecialization:ut.Z.state.pickedSpecialization,isLoading:!1,schedAvailability:!1,radioIndex:null,prefix:null,hospital:ut.Z.state.hospitalName,refID:null,errMsg:"",initialScheduleCheck:!0,appointmentCategory:"",appointmentCategories:[],client:(0,gt.Z)("sk_test_Y6nQ7BnqHoe8Ua4Q9ytu7rb4"),checkoutUrl:"",paymentFirstToggle:!1,paymentFirst:!1,paymentAmount:"",paymentFailed:!1,paymentStatus:ut.Z.state.paymentStatus,paymentSuccesPatientDetails:ut.Z.state.patientDetails,paymentWindowWaiting:!1}},async created(){"pending"!==this.paymentStatus&&"failed"==this.paymentStatus&&(this.paymentFailed=!0,ut.Z.commit("paymentStatus","pending"))},async mounted(){this.doctorSched=this.doctorSched.filter((t=>new Date(t.date).getTime()>(new Date).getTime()&&t.hospital===this.hospital)).sort(((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime())),await pt.Z.get("/session/patient").then((t=>this.patient=t.data)),this.firstName=await this.patient.name[0],this.lastName=await this.patient.name[1],this.checkPatientRecord=await this.doctorDetails.patients.find((t=>t.patient===this.patient._id)),this.currentAddress=await this.patient.currentAddress;for await(const[t,e]of this.doctorSched.entries())await this.pickSched(t,e,e.prefix,e.appointmentCategories,e.paymentFirst,e.paymentAmount);this.initialScheduleCheck=!1},methods:{async appoint(){this.isLoading=!0;let t=document.getElementsByClassName("radioSched"),e=document.getElementsByClassName("statusSched");if(await pt.Z.post("/api/appointmentList/doctors/checkPriority",{doctorID:this.doctorDetails._id,schedule:this.schedule.date}).then((t=>this.patientsAppointed=t.data)),await this.patientsAppointed<this.schedule.appointmentLimit){await pt.Z.post("/api/appointmentList/doctors/checkPriority",{doctorID:this.doctorDetails._id,schedule:this.schedule.date}).then((t=>this.priorityNum=t.data+1));try{"undefined"!==typeof this.checkPatientRecord&&this.checkPatientRecord||await pt.Z.post("/api/patientUpdate",{doctorID:this.doctorDetails._id,patientID:this.patient._id,patientFullName:this.firstName+" "+this.lastName}),this.generateRefID(),await pt.Z.put(`/api/manager/${ut.Z.state.hospitalDetails._id}`,{engagements:ut.Z.state.hospitalDetails.engagements+5}),await pt.Z.post("/api/appointmentList",{referenceID:this.refID,hospital:this.hospital,doctorID:this.doctorDetails._id,doctorName:this.doctorDetails.name,doctorSpecialization:this.pickedSpecialization,patientID:this.patient._id,firstName:this.firstName,lastName:this.lastName,contactNum:this.contactNum,birthDay:this.birthDay.toDateString(),comments:this.comments,schedule:this.schedule,priorityNum:this.prefix?this.prefix+"-"+this.priorityNum:this.priorityNum,appointmentCategory:this.appointmentCategory}).then((async t=>{this.paymentFirst?(ut.Z.commit("patientDetails",t.data),await this.createSource()):(ut.Z.commit("patientDetails",t.data),ut.Z.commit("appointed",!0),await this.$router.push("/success"))}))}catch(i){this.errMsg=i}}else this.schedAvailability=!1,this.schedule=null,t[this.radioIndex].checked=!1,t[this.radioIndex].disabled=!0,e[this.radioIndex].style.display="block";this.isLoading=!1},async pickSched(t,e,i,a,s,l){this.appointmentCategory=a[0],this.initialScheduleCheck||(this.appointmentCategories=a),this.radioIndex=t,this.isLoading=!0;let n=document.getElementsByClassName("radioSched"),o=document.getElementsByClassName("statusSched");for(let c=0;c<o.length;c++)o[c].style.display="none";this.schedule=await e,await pt.Z.post("/api/appointmentList/doctors/checkPriority",{doctorID:this.doctorDetails._id,schedule:this.schedule.date}).then((t=>this.patientsAppointed=t.data)),await this.patientsAppointed<this.schedule.appointmentLimit?(this.isLoading=!1,this.initialScheduleCheck||(this.schedAvailability=!0,this.prefix=i,o[t].style.display="block"),s&&!this.initialScheduleCheck&&(this.paymentFirst=!0,this.paymentFirstToggle=!0,this.paymentAmount=l)):(this.isLoading=!1,this.schedAvailability=!1,this.schedule=null,n[t].checked=!1,o[t].style.display="block",this.paymentFirst=!1,this.paymentAmount="",this.initialScheduleCheck&&(this.doctorSched=this.doctorSched.filter((t=>t!=e)))),this.initialScheduleCheck&&(this.schedule=null)},generateRefID(){let t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=e.length;for(let a=0;a<12;a++)t+=e.charAt(Math.floor(Math.random()*i));this.refID=t.toUpperCase()},async createSource(){const t=location.origin;try{await this.client.source.create({type:"gcash",currency:"PHP",amount:parseInt(`${this.paymentAmount}00`),redirect:{success:`${t}/payment-status`,failed:`${t}/payment-status`}}).then((t=>{this.checkoutUrl=t.data.attributes.redirect.checkout_url,ut.Z.commit("paymentID",t.data.id)})),this.checkoutUrl&&window.location.replace(this.checkoutUrl)}catch(e){this.isLoading=!1,this.errMsg=e}},reloadPage(){location.reload()}}},bt=i(3744);const ft=(0,bt.Z)(_t,[["render",ht],["__scopeId","data-v-47a13b93"]]);var vt=ft}}]);
//# sourceMappingURL=329.d9ebb366.js.map