"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[567],{2492:function(t,e,i){i.r(e),i.d(e,{default:function(){return Zt}});var a=i(6252),s=i(3577),n=i(9963);const l=t=>((0,a.dD)("data-v-66fb40b0"),t=t(),(0,a.Cn)(),t),o={class:"section"},c={key:0,class:"notification is-warning"},d=l((()=>(0,a._)("div",{class:"modal-background"},null,-1))),r=l((()=>(0,a._)("div",{class:"modal-content",style:{overflow:"hidden"}},[(0,a._)("div",{class:"loader",style:{margin:"auto"}})],-1))),p=[d,r],h=l((()=>(0,a._)("div",{class:"modal-background"},null,-1))),u={class:"modal-content box"},m={class:"section"},y=l((()=>(0,a._)("div",{class:"notification is-info"},"This schedule requires you to pay first before continuing!",-1))),g={class:"buttons is-centered"},b=l((()=>(0,a._)("div",{class:"modal-background"},null,-1))),_={class:"modal-content box"},f={class:"section"},v=l((()=>(0,a._)("div",{class:"notification is-info"},"You have an existing appointment with the same details, do you want to cancel your last appointment and make a new appointment?",-1))),k={class:"buttons is-centered"},w=l((()=>(0,a._)("div",{class:"modal-background"},null,-1))),D={class:"modal-content box"},C={class:"section"},N=l((()=>(0,a._)("div",{class:"notification is-info"},"You have an existing appointment with the same schedule, do you want to continue with your appointment?",-1))),A={class:"buttons is-centered"},S={class:"columns registration-form",style:{width:"75%",margin:"auto"}},I={class:"column"},x=l((()=>(0,a._)("div",{class:"block"},"To book your appointment, we have to verify a few details.",-1))),Z={class:"field is-horizontal"},P={class:"field-body"},L={class:"field"},F=l((()=>(0,a._)("label",{class:"label"},"First name",-1))),U={class:"control"},T={class:"field"},z=l((()=>(0,a._)("label",{class:"label"},"Last Name",-1))),M={class:"control"},V={class:"field is-horizontal"},Y={class:"field-body"},q={class:"field"},R=l((()=>(0,a._)("label",{class:"label"},"Contact Number:",-1))),E={class:"control"},B={class:"field"},H=l((()=>(0,a._)("label",{class:"label"},"Birthdate",-1))),W={class:"control"},$={class:"is-block"},K=["onClick"],Q=["value"],j={class:"field"},G={class:"control"},J=l((()=>(0,a._)("label",{class:"label"},"Current Address",-1))),O=["value"],X={class:"field"},tt=l((()=>(0,a._)("label",{class:"label"},"Reason for your visit:",-1))),et={class:"column",style:{position:"relative"}},it={class:"field"},at=l((()=>(0,a._)("h1",{class:"subtitle is-5 has-text-black has-text-weight-bold"},"Pick your preferred schedule: ",-1))),st=l((()=>(0,a._)("div",{class:"block"},null,-1))),nt={class:"controls"},lt={class:"radio"},ot=["onClick"],ct={class:"subtitle is-6 has-text-weight-semibold"},dt=l((()=>(0,a._)("br",null,null,-1))),rt={class:"has-text-black"},pt={style:{"pointer-events":"none"},class:"button statusSched"},ht={key:0,class:"has-text-success"},ut={key:1,class:"has-text-danger"},mt={key:0,class:"block has-text-centered"},yt=l((()=>(0,a._)("hr",null,null,-1))),gt=l((()=>(0,a._)("h1",{class:"subtitle is-5 has-text-black has-text-weight-bold has-text-left"},"Let the doctor know what are you appointing for: ",-1))),bt={class:"select"},_t=["value"],ft={class:"block has-text-centered"},vt=["disabled"];function kt(t,e,i,l,d,r){const kt=(0,a.up)("NavigationTab"),wt=(0,a.up)("CatchError"),Dt=(0,a.up)("v-date-picker");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(kt),(0,a._)("section",o,[(0,a.Wm)(wt,{"err-msg":d.errMsg},null,8,["err-msg"]),d.paymentFailed?((0,a.wg)(),(0,a.iD)("div",c,"Payment transaction failed. Please try again.")):(0,a.kq)("",!0),(0,a._)("div",{class:(0,s.C_)(["modal",{"is-active":d.isLoading}])},p,2),(0,a._)("div",{class:(0,s.C_)(["modal",{"is-active":d.paymentFirstToggle}])},[h,(0,a._)("div",u,[(0,a._)("section",m,[y,(0,a._)("div",g,[(0,a._)("button",{class:"button",onClick:e[0]||(e[0]=(...t)=>r.reloadPage&&r.reloadPage(...t))},"Cancel"),(0,a._)("button",{class:"button is-info",onClick:e[1]||(e[1]=t=>d.paymentFirstToggle=!1)},"Confirm")])])])],2),(0,a._)("div",{class:(0,s.C_)(["modal",{"is-active":d.doubleAppointmentID}])},[b,(0,a._)("div",_,[(0,a._)("section",f,[v,(0,a._)("div",k,[(0,a._)("button",{class:"button",onClick:e[2]||(e[2]=(...t)=>r.reloadPage&&r.reloadPage(...t))},"No"),(0,a._)("button",{class:"button is-info",onClick:e[3]||(e[3]=(...t)=>r.reAppointment&&r.reAppointment(...t))},"Yes")])])])],2),(0,a._)("div",{class:(0,s.C_)(["modal",{"is-active":d.multipleAppointment}])},[w,(0,a._)("div",D,[(0,a._)("section",C,[N,(0,a._)("div",A,[(0,a._)("button",{class:"button",onClick:e[4]||(e[4]=(...t)=>r.reloadPage&&r.reloadPage(...t))},"No"),(0,a._)("button",{class:"button is-info",onClick:e[5]||(e[5]=(...t)=>r.appoint&&r.appoint(...t))},"Yes")])])])],2),(0,a._)("div",S,[(0,a._)("div",I,[(0,a._)("form",null,[x,(0,a._)("div",Z,[(0,a._)("div",P,[(0,a._)("div",L,[F,(0,a._)("div",U,[(0,a.wy)((0,a._)("input",{class:"input",type:"text","onUpdate:modelValue":e[6]||(e[6]=t=>d.firstName=t),placeholder:"First Name",required:""},null,512),[[n.nr,d.firstName]])])]),(0,a._)("div",T,[z,(0,a._)("div",M,[(0,a.wy)((0,a._)("input",{class:"input",type:"text","onUpdate:modelValue":e[7]||(e[7]=t=>d.lastName=t),placeholder:"Last Name",required:""},null,512),[[n.nr,d.lastName]])])])])]),(0,a._)("div",V,[(0,a._)("div",Y,[(0,a._)("div",q,[R,(0,a._)("div",E,[(0,a.wy)((0,a._)("input",{class:"input",type:"number","onUpdate:modelValue":e[8]||(e[8]=t=>d.contactNum=t),placeholder:"Contact Number",required:""},null,512),[[n.nr,d.contactNum]])])]),(0,a._)("div",B,[H,(0,a._)("div",W,[(0,a.Wm)(Dt,{class:"block",modelValue:d.birthDay,"onUpdate:modelValue":e[9]||(e[9]=t=>d.birthDay=t)},{default:(0,a.w5)((({inputValue:t,togglePopover:e})=>[(0,a._)("div",$,[(0,a._)("a",{style:{margin:"auto"},onClick:t=>e()},[(0,a._)("input",{style:{cursor:"pointer"},value:t,class:"input",readonly:""},null,8,Q)],8,K)])])),_:1},8,["modelValue"])])])])]),(0,a._)("div",j,[(0,a._)("div",G,[J,(0,a._)("input",{class:"input",type:"text",value:d.currentAddress},null,8,O)])]),(0,a._)("div",X,[tt,(0,a.wy)((0,a._)("textarea",{class:"textarea",style:{"white-space":"pre-wrap"},"onUpdate:modelValue":e[10]||(e[10]=t=>d.comments=t),placeholder:"Your symptoms, general well being etc...",required:""},null,512),[[n.nr,d.comments]])])])]),(0,a._)("div",et,[(0,a._)("form",it,[at,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(d.doctorSched,((t,e)=>((0,a.wg)(),(0,a.iD)("div",{key:t.id,style:{width:"75%",margin:"auto"}},[st,(0,a._)("div",nt,[(0,a._)("label",lt,[(0,a._)("input",{type:"radio",class:"radioSched",name:"schedule",onClick:i=>r.pickSched(e,t,t.prefix,t.appointmentCategories,t.paymentFirst,t.paymentAmount)},null,8,ot),(0,a._)("span",ct,"Â "+(0,s.zw)(new Date(t.date).toDateString()),1),dt,(0,a._)("span",rt,(0,s.zw)(t.timeStart)+" - "+(0,s.zw)(t.timeEnd),1)]),(0,a._)("a",pt,[d.schedAvailability?((0,a.wg)(),(0,a.iD)("span",ht,"Available")):((0,a.wg)(),(0,a.iD)("span",ut,"Unavailable"))])])])))),128))]),0!==d.appointmentCategories.length?((0,a.wg)(),(0,a.iD)("div",mt,[yt,gt,(0,a._)("div",bt,[(0,a.wy)((0,a._)("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>d.appointmentCategory=t)},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(d.appointmentCategories,(t=>((0,a.wg)(),(0,a.iD)("option",{key:t,value:t},(0,s.zw)(t),9,_t)))),128))],512),[[n.bM,d.appointmentCategory]])])])):(0,a.kq)("",!0),(0,a._)("div",ft,[(0,a._)("button",{type:"button",class:"button is-info",disabled:null==d.comments||null==d.schedule||""==d.firstName||""==d.lastName||null==d.birthDay||""==d.contactNum||""==d.comments||""==d.currentAddress,onClick:e[12]||(e[12]=(...t)=>r.checkAppointmentDuplication&&r.checkAppointmentDuplication(...t))},"Submit appointment",8,vt)])])])])],64)}var wt=i(594),Dt=i(4239),Ct=i(4824),Nt=i(7787),At=i(3343),St={name:"RegForm",components:{NavigationTab:Ct.Z,CatchError:Nt.Z},data(){return{checkPatientRecord:null,patient:null,doctorSched:Dt.Z.state.doctorDetails.schedule,firstName:null,lastName:null,birthDay:null,comments:null,contactNum:null,schedule:null,currentAddress:null,priorityNum:null,patientsAppointed:null,doctorDetails:Dt.Z.state.doctorDetails,pickedSpecialization:Dt.Z.state.pickedSpecialization,isLoading:!1,schedAvailability:!1,radioIndex:null,prefix:null,hospital:Dt.Z.state.hospitalName,refID:null,errMsg:"",initialScheduleCheck:!0,appointmentCategory:"",appointmentCategories:[],client:(0,At.Z)("sk_test_Y6nQ7BnqHoe8Ua4Q9ytu7rb4"),checkoutUrl:"",paymentFirstToggle:!1,paymentFirst:!1,paymentAmount:"",paymentFailed:!1,paymentStatus:Dt.Z.state.paymentStatus,paymentSuccesPatientDetails:Dt.Z.state.patientDetails,paymentWindowWaiting:!1,doubleAppointmentID:!1,multipleAppointment:!1}},async created(){"pending"!==this.paymentStatus&&"failed"==this.paymentStatus&&(this.paymentFailed=!0,Dt.Z.commit("paymentStatus","pending"))},async mounted(){this.doctorSched=this.doctorSched.filter((t=>new Date(t.date).getTime()>(new Date).getTime()&&t.hospital===this.hospital)).sort(((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime())),await wt.Z.get("/session/patient").then((t=>this.patient=t.data)),this.firstName=await this.patient.name[0],this.lastName=await this.patient.name[1],this.checkPatientRecord=await this.doctorDetails.patients.find((t=>t.patient===this.patient._id)),this.currentAddress=await this.patient.currentAddress;for await(const[t,e]of this.doctorSched.entries())await this.pickSched(t,e,e.prefix,e.appointmentCategories,e.paymentFirst,e.paymentAmount);this.initialScheduleCheck=!1},methods:{async checkAppointmentDuplication(){try{await wt.Z.post("/api/appointmentList/check-double-appointment",{firstName:this.firstName,lastName:this.lastName,schedule:this.schedule,patientID:this.patient._id,doctorID:this.doctorDetails._id}).then((t=>t.data?this.doubleAppointmentID=t.data:this.doubleAppointmentID=!1)),this.doubleAppointmentID||await wt.Z.post("/api/appointmentList/check-multiple-appointment",{schedule:this.schedule,patientID:this.patient._id,doctorID:this.doctorDetails._id}).then((t=>t.data?this.multipleAppointment=!0:this.multipleAppointment=!1))}catch(t){this.errMsg=t}this.doubleAppointmentID||this.multipleAppointment||await this.appoint()},async reAppointment(){await wt.Z["delete"](`/api/appointmentList/${this.doubleAppointmentID}`).catch((t=>this.errMsg=t)),this.doubleAppointmentID=!1,await this.appoint()},async appoint(){this.isLoading=!0;let t=document.getElementsByClassName("radioSched"),e=document.getElementsByClassName("statusSched");if(await wt.Z.post("/api/appointmentList/doctors/checkPriority",{doctorID:this.doctorDetails._id,schedule:this.schedule.date}).then((t=>this.patientsAppointed=t.data)),await this.patientsAppointed<this.schedule.appointmentLimit){await wt.Z.post("/api/appointmentList/doctors/checkPriority",{doctorID:this.doctorDetails._id,schedule:this.schedule.date}).then((t=>this.priorityNum=t.data+1));try{"undefined"!==typeof this.checkPatientRecord&&this.checkPatientRecord||await wt.Z.post("/api/patientUpdate",{doctorID:this.doctorDetails._id,patientID:this.patient._id,patientFullName:this.firstName+" "+this.lastName}),this.generateRefID(),await wt.Z.put(`/api/manager/${Dt.Z.state.hospitalDetails._id}`,{engagements:Dt.Z.state.hospitalDetails.engagements+5}),await wt.Z.post("/api/appointmentList",{referenceID:this.refID,hospital:this.hospital,doctorID:this.doctorDetails._id,doctorName:this.doctorDetails.name,doctorSpecialization:this.pickedSpecialization,patientID:this.patient._id,firstName:this.firstName,lastName:this.lastName,contactNum:this.contactNum,birthDay:this.birthDay.toDateString(),comments:this.comments,schedule:this.schedule,priorityNum:this.prefix?this.prefix+"-"+this.priorityNum:this.priorityNum,appointmentCategory:this.appointmentCategory}).then((async t=>{this.paymentFirst?(Dt.Z.commit("patientDetails",t.data),await this.createSource()):(Dt.Z.commit("patientDetails",t.data),Dt.Z.commit("appointed",!0),await this.$router.push("/success"))}))}catch(i){this.errMsg=i}}else this.schedAvailability=!1,this.schedule=null,t[this.radioIndex].checked=!1,t[this.radioIndex].disabled=!0,e[this.radioIndex].style.display="block";this.isLoading=!1},async pickSched(t,e,i,a,s,n){this.appointmentCategory=a[0],this.initialScheduleCheck||(this.appointmentCategories=a),this.radioIndex=t,this.isLoading=!0;let l=document.getElementsByClassName("radioSched"),o=document.getElementsByClassName("statusSched");for(let c=0;c<o.length;c++)o[c].style.display="none";this.schedule=await e,await wt.Z.post("/api/appointmentList/doctors/checkPriority",{doctorID:this.doctorDetails._id,schedule:this.schedule.date}).then((t=>this.patientsAppointed=t.data)),await this.patientsAppointed<this.schedule.appointmentLimit?(this.isLoading=!1,this.initialScheduleCheck||(this.schedAvailability=!0,this.prefix=i,o[t].style.display="block"),s&&!this.initialScheduleCheck&&(this.paymentFirst=!0,this.paymentFirstToggle=!0,this.paymentAmount=n)):(this.isLoading=!1,this.schedAvailability=!1,this.schedule=null,l[t].checked=!1,o[t].style.display="block",this.paymentFirst=!1,this.paymentAmount="",this.initialScheduleCheck&&(this.doctorSched=this.doctorSched.filter((t=>t!=e)))),this.initialScheduleCheck&&(this.schedule=null)},generateRefID(){let t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=e.length;for(let a=0;a<12;a++)t+=e.charAt(Math.floor(Math.random()*i));this.refID=t.toUpperCase()},async createSource(){const t=location.origin;try{await this.client.source.create({type:"gcash",currency:"PHP",amount:parseInt(`${this.paymentAmount}00`),redirect:{success:`${t}/payment-status`,failed:`${t}/payment-status`}}).then((t=>{this.checkoutUrl=t.data.attributes.redirect.checkout_url,Dt.Z.commit("paymentID",t.data.id)})),this.checkoutUrl&&window.location.replace(this.checkoutUrl)}catch(e){this.isLoading=!1,this.errMsg=e}},reloadPage(){location.reload()}}},It=i(3744);const xt=(0,It.Z)(St,[["render",kt],["__scopeId","data-v-66fb40b0"]]);var Zt=xt}}]);
//# sourceMappingURL=567.cfac5c7f.js.map