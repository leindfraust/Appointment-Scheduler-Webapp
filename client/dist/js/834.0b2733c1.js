"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[834],{1526:function(t,e,i){i.r(e),i.d(e,{default:function(){return Tt}});var a=i(6252),s=i(3577),n=i(9963);const l=t=>((0,a.dD)("data-v-55cdaea8"),t=t(),(0,a.Cn)(),t),o={class:"section"},c={key:0,class:"notification is-warning"},d=l((()=>(0,a._)("div",{class:"modal-background"},null,-1))),r=l((()=>(0,a._)("div",{class:"modal-content",style:{overflow:"hidden"}},[(0,a._)("div",{class:"loader",style:{margin:"auto"}})],-1))),p=[d,r],h=l((()=>(0,a._)("div",{class:"modal-background"},null,-1))),u={class:"modal-content box"},m={class:"section"},y=l((()=>(0,a._)("div",{class:"notification is-info"},"This schedule requires you to pay first before continuing!",-1))),_={class:"buttons is-centered"},b=l((()=>(0,a._)("div",{class:"modal-background"},null,-1))),g={class:"modal-content box"},f={class:"section"},v=l((()=>(0,a._)("div",{class:"notification is-info"},"You have an existing appointment with the same details, do you want to cancel your last appointment and make a new appointment?",-1))),k={class:"buttons is-centered"},D=l((()=>(0,a._)("div",{class:"modal-background"},null,-1))),w={class:"modal-content box"},C={class:"section"},N=l((()=>(0,a._)("div",{class:"notification is-info"},"You have an existing appointment with the same schedule, do you want to continue with your appointment?",-1))),A={class:"buttons is-centered"},S=l((()=>(0,a._)("div",{class:"modal-background"},null,-1))),x={class:"modal-content box"},I={class:"section"},Z=l((()=>(0,a._)("div",{class:"notification is-info"},"Before we continue, please confirm the patient's details to ensure they are correct as they cannot be changed later on. Do you want to continue?",-1))),P={class:"buttons is-centered"},L={class:"columns registration-form",style:{width:"75%",margin:"auto"}},F={class:"column"},U=l((()=>(0,a._)("div",{class:"block"},"Please enter the patient's information.",-1))),T={class:"field is-horizontal"},z={class:"field-body"},Y={class:"field"},M=l((()=>(0,a._)("label",{class:"label"},"First name",-1))),V={class:"control"},q={class:"field"},R=l((()=>(0,a._)("label",{class:"label"},"Last Name",-1))),B={class:"control"},E={class:"field is-horizontal"},$={class:"field-body"},H={class:"field"},W=l((()=>(0,a._)("label",{class:"label"},"Contact Number:",-1))),K={class:"control"},Q={class:"field"},j=l((()=>(0,a._)("label",{class:"label"},"Birthdate",-1))),G={class:"control"},J={class:"is-block"},O=["onClick"],X=["value"],tt={class:"field"},et={class:"control"},it=l((()=>(0,a._)("label",{class:"label"},"Current Address",-1))),at=["value"],st={class:"field"},nt=l((()=>(0,a._)("label",{class:"label"},"Reason for your visit:",-1))),lt={class:"column",style:{position:"relative"}},ot={class:"field"},ct=l((()=>(0,a._)("h1",{class:"subtitle is-5 has-text-black has-text-weight-bold"},"Pick your preferred schedule: ",-1))),dt=l((()=>(0,a._)("div",{class:"block"},null,-1))),rt={class:"controls"},pt={class:"radio"},ht=["onClick"],ut={class:"subtitle is-6 has-text-weight-semibold"},mt=l((()=>(0,a._)("br",null,null,-1))),yt={class:"has-text-black"},_t={style:{"pointer-events":"none"},class:"button statusSched"},bt={key:0,class:"has-text-success"},gt={key:1,class:"has-text-danger"},ft={key:0,class:"block has-text-centered"},vt=l((()=>(0,a._)("hr",null,null,-1))),kt=l((()=>(0,a._)("h1",{class:"subtitle is-5 has-text-black has-text-weight-bold has-text-left"},"Let the doctor know what are you appointing for: ",-1))),Dt={class:"select"},wt=["value"],Ct={class:"block has-text-centered"},Nt=["disabled"];function At(t,e,i,l,d,r){const At=(0,a.up)("NavigationTab"),St=(0,a.up)("CatchError"),xt=(0,a.up)("v-date-picker");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(At),(0,a._)("section",o,[(0,a.Wm)(St,{"err-msg":d.errMsg},null,8,["err-msg"]),d.paymentFailed?((0,a.wg)(),(0,a.iD)("div",c,"Payment transaction failed. Please try again.")):(0,a.kq)("",!0),(0,a._)("div",{class:(0,s.C_)(["modal",{"is-active":d.isLoading}])},p,2),(0,a._)("div",{class:(0,s.C_)(["modal",{"is-active":d.paymentFirstToggle}])},[h,(0,a._)("div",u,[(0,a._)("section",m,[y,(0,a._)("div",_,[(0,a._)("button",{class:"button",onClick:e[0]||(e[0]=(...t)=>r.reloadPage&&r.reloadPage(...t))},"Cancel"),(0,a._)("button",{class:"button is-info",onClick:e[1]||(e[1]=t=>d.paymentFirstToggle=!1)},"Confirm")])])])],2),(0,a._)("div",{class:(0,s.C_)(["modal",{"is-active":d.doubleAppointmentID}])},[b,(0,a._)("div",g,[(0,a._)("section",f,[v,(0,a._)("div",k,[(0,a._)("button",{class:"button",onClick:e[2]||(e[2]=(...t)=>r.reloadPage&&r.reloadPage(...t))},"No"),(0,a._)("button",{class:"button is-info",onClick:e[3]||(e[3]=(...t)=>r.reAppointment&&r.reAppointment(...t))},"Yes")])])])],2),(0,a._)("div",{class:(0,s.C_)(["modal",{"is-active":d.multipleAppointment}])},[D,(0,a._)("div",w,[(0,a._)("section",C,[N,(0,a._)("div",A,[(0,a._)("button",{class:"button",onClick:e[4]||(e[4]=(...t)=>r.reloadPage&&r.reloadPage(...t))},"No"),(0,a._)("button",{class:"button is-info",onClick:e[5]||(e[5]=(...t)=>r.appoint&&r.appoint(...t))},"Yes")])])])],2),(0,a._)("div",{class:(0,s.C_)(["modal",{"is-active":d.confirmDetails}])},[S,(0,a._)("div",x,[(0,a._)("section",I,[Z,(0,a._)("div",P,[(0,a._)("button",{class:"button",onClick:e[6]||(e[6]=t=>d.confirmDetails=!1)},"No"),(0,a._)("button",{class:"button is-info",onClick:e[7]||(e[7]=t=>d.confirmDetails?r.checkAppointmentDuplication():d.confirmDetails=!1)},"Yes")])])])],2),(0,a._)("div",L,[(0,a._)("div",F,[(0,a._)("form",null,[U,(0,a._)("div",T,[(0,a._)("div",z,[(0,a._)("div",Y,[M,(0,a._)("div",V,[(0,a.wy)((0,a._)("input",{class:"input",type:"text","onUpdate:modelValue":e[8]||(e[8]=t=>d.firstName=t),placeholder:"First Name",required:""},null,512),[[n.nr,d.firstName]])])]),(0,a._)("div",q,[R,(0,a._)("div",B,[(0,a.wy)((0,a._)("input",{class:"input",type:"text","onUpdate:modelValue":e[9]||(e[9]=t=>d.lastName=t),placeholder:"Last Name",required:""},null,512),[[n.nr,d.lastName]])])])])]),(0,a._)("div",E,[(0,a._)("div",$,[(0,a._)("div",H,[W,(0,a._)("div",K,[(0,a.wy)((0,a._)("input",{class:"input",type:"number","onUpdate:modelValue":e[10]||(e[10]=t=>d.contactNum=t),placeholder:"Contact Number",required:""},null,512),[[n.nr,d.contactNum]])])]),(0,a._)("div",Q,[j,(0,a._)("div",G,[(0,a.Wm)(xt,{class:"block",modelValue:d.birthDay,"onUpdate:modelValue":e[11]||(e[11]=t=>d.birthDay=t)},{default:(0,a.w5)((({inputValue:t,togglePopover:e})=>[(0,a._)("div",J,[(0,a._)("a",{style:{margin:"auto"},onClick:t=>e()},[(0,a._)("input",{style:{cursor:"pointer"},value:t,class:"input",readonly:""},null,8,X)],8,O)])])),_:1},8,["modelValue"])])])])]),(0,a._)("div",tt,[(0,a._)("div",et,[it,(0,a._)("input",{class:"input",type:"text",value:d.currentAddress},null,8,at)])]),(0,a._)("div",st,[nt,(0,a.wy)((0,a._)("textarea",{class:"textarea",style:{"white-space":"pre-wrap"},"onUpdate:modelValue":e[12]||(e[12]=t=>d.comments=t),placeholder:"Your symptoms, general well being etc...",required:""},null,512),[[n.nr,d.comments]])])])]),(0,a._)("div",lt,[(0,a._)("form",ot,[ct,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(d.doctorSched,((t,e)=>((0,a.wg)(),(0,a.iD)("div",{key:t.id,style:{width:"75%",margin:"auto"}},[dt,(0,a._)("div",rt,[(0,a._)("label",pt,[(0,a._)("input",{type:"radio",class:"radioSched",name:"schedule",onClick:i=>r.pickSched(e,t,t.prefix,t.appointmentCategories,t.paymentFirst,t.paymentAmount)},null,8,ht),(0,a._)("span",ut,"Â "+(0,s.zw)(new Date(t.date).toDateString()),1),mt,(0,a._)("span",yt,(0,s.zw)(t.timeStart)+" - "+(0,s.zw)(t.timeEnd),1)]),(0,a._)("a",_t,[d.schedAvailability?((0,a.wg)(),(0,a.iD)("span",bt,"Available")):((0,a.wg)(),(0,a.iD)("span",gt,"Unavailable"))])])])))),128))]),0!==d.appointmentCategories.length?((0,a.wg)(),(0,a.iD)("div",ft,[vt,kt,(0,a._)("div",Dt,[(0,a.wy)((0,a._)("select",{"onUpdate:modelValue":e[13]||(e[13]=t=>d.appointmentCategory=t)},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(d.appointmentCategories,(t=>((0,a.wg)(),(0,a.iD)("option",{key:t,value:t},(0,s.zw)(t),9,wt)))),128))],512),[[n.bM,d.appointmentCategory]])])])):(0,a.kq)("",!0),(0,a._)("div",Ct,[(0,a._)("button",{type:"button",class:"button is-info",disabled:null==d.comments||null==d.schedule||""==d.firstName||""==d.lastName||null==d.birthDay||""==d.contactNum||""==d.comments||""==d.currentAddress,onClick:e[14]||(e[14]=t=>d.confirmDetails=!0)},"Submit appointment",8,Nt)])])])])],64)}var St=i(594),xt=i(4239),It=i(4824),Zt=i(7787),Pt=i(3343),Lt={name:"RegForm",components:{NavigationTab:It.Z,CatchError:Zt.Z},data(){return{checkPatientRecord:null,patient:null,doctorSched:xt.Z.state.doctorDetails.schedule,firstName:null,lastName:null,birthDay:null,comments:null,contactNum:null,schedule:null,currentAddress:null,priorityNum:null,patientsAppointed:null,doctorDetails:xt.Z.state.doctorDetails,pickedSpecialization:xt.Z.state.pickedSpecialization,isLoading:!1,schedAvailability:!1,radioIndex:null,prefix:null,hospital:xt.Z.state.hospitalName,refID:null,errMsg:"",initialScheduleCheck:!0,appointmentCategory:"",appointmentCategories:[],client:(0,Pt.Z)("sk_test_Y6nQ7BnqHoe8Ua4Q9ytu7rb4"),checkoutUrl:"",paymentFirstToggle:!1,paymentFirst:!1,paymentAmount:"",paymentFailed:!1,paymentStatus:xt.Z.state.paymentStatus,paymentSuccesPatientDetails:xt.Z.state.patientDetails,paymentWindowWaiting:!1,doubleAppointmentID:!1,multipleAppointment:!1,confirmDetails:!1}},async created(){"pending"!==this.paymentStatus&&"failed"==this.paymentStatus&&(this.paymentFailed=!0,xt.Z.commit("paymentStatus","pending"))},async mounted(){this.doctorSched=this.doctorSched.filter((t=>new Date(t.date).getTime()>(new Date).getTime()&&t.hospital===this.hospital)).sort(((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime())),await St.Z.get("/session/patient").then((t=>this.patient=t.data)),this.firstName=await this.patient.name[0],this.lastName=await this.patient.name[1],this.checkPatientRecord=await this.doctorDetails.patients.find((t=>t.patient===this.patient._id)),this.currentAddress=await this.patient.currentAddress;for await(const[t,e]of this.doctorSched.entries())await this.pickSched(t,e,e.prefix,e.appointmentCategories,e.paymentFirst,e.paymentAmount);this.initialScheduleCheck=!1},methods:{async checkAppointmentDuplication(){this.confirmDetails=!1;try{await St.Z.post("/api/appointmentList/check-double-appointment",{firstName:this.firstName,lastName:this.lastName,schedule:this.schedule,patientID:this.patient._id,doctorID:this.doctorDetails._id}).then((t=>t.data?this.doubleAppointmentID=t.data:this.doubleAppointmentID=!1)),this.doubleAppointmentID||await St.Z.post("/api/appointmentList/check-multiple-appointment",{schedule:this.schedule,patientID:this.patient._id,doctorID:this.doctorDetails._id}).then((t=>t.data?this.multipleAppointment=!0:this.multipleAppointment=!1))}catch(t){this.errMsg=t}this.doubleAppointmentID||this.multipleAppointment||await this.appoint()},async reAppointment(){await St.Z["delete"](`/api/appointmentList/${this.doubleAppointmentID}`).catch((t=>this.errMsg=t)),this.doubleAppointmentID=!1,await this.appoint()},async appoint(){this.isLoading=!0;let t=document.getElementsByClassName("radioSched"),e=document.getElementsByClassName("statusSched");if(await St.Z.post("/api/appointmentList/doctors/checkPriority",{doctorID:this.doctorDetails._id,schedule:this.schedule.date}).then((t=>this.patientsAppointed=t.data)),await this.patientsAppointed<this.schedule.appointmentLimit){await St.Z.post("/api/appointmentList/doctors/checkPriority",{doctorID:this.doctorDetails._id,schedule:this.schedule.date}).then((t=>this.priorityNum=t.data+1));try{"undefined"!==typeof this.checkPatientRecord&&this.checkPatientRecord||await St.Z.post("/api/patientUpdate",{doctorID:this.doctorDetails._id,patientID:this.patient._id,patientFullName:this.firstName+" "+this.lastName}),this.generateRefID(),await St.Z.put(`/api/manager/${xt.Z.state.hospitalDetails._id}`,{engagements:xt.Z.state.hospitalDetails.engagements+5}),await St.Z.post("/api/appointmentList",{referenceID:this.refID,hospital:this.hospital,doctorID:this.doctorDetails._id,doctorName:this.doctorDetails.name,doctorSpecialization:this.pickedSpecialization,patientID:this.patient._id,firstName:this.firstName,lastName:this.lastName,contactNum:this.contactNum,birthDay:this.birthDay.toDateString(),comments:this.comments,schedule:this.schedule,priorityNum:this.prefix?this.prefix+"-"+this.priorityNum:this.priorityNum,appointmentCategory:this.appointmentCategory}).then((async t=>{this.paymentFirst?(xt.Z.commit("patientDetails",t.data),await this.createSource()):(xt.Z.commit("patientDetails",t.data),xt.Z.commit("appointed",!0),await this.$router.push("/success"))}))}catch(i){this.errMsg=i}}else this.schedAvailability=!1,this.schedule=null,t[this.radioIndex].checked=!1,t[this.radioIndex].disabled=!0,e[this.radioIndex].style.display="block";this.isLoading=!1},async pickSched(t,e,i,a,s,n){this.appointmentCategory=a[0],this.initialScheduleCheck||(this.appointmentCategories=a),this.radioIndex=t,this.isLoading=!0;let l=document.getElementsByClassName("radioSched"),o=document.getElementsByClassName("statusSched");for(let c=0;c<o.length;c++)o[c].style.display="none";this.schedule=await e,await St.Z.post("/api/appointmentList/doctors/checkPriority",{doctorID:this.doctorDetails._id,schedule:this.schedule.date}).then((t=>this.patientsAppointed=t.data)),await this.patientsAppointed<this.schedule.appointmentLimit?(this.isLoading=!1,this.initialScheduleCheck||(this.schedAvailability=!0,this.prefix=i,o[t].style.display="block"),s&&!this.initialScheduleCheck&&(this.paymentFirst=!0,this.paymentFirstToggle=!0,this.paymentAmount=n)):(this.isLoading=!1,this.schedAvailability=!1,this.schedule=null,l[t].checked=!1,o[t].style.display="block",this.paymentFirst=!1,this.paymentAmount="",this.initialScheduleCheck&&(this.doctorSched=this.doctorSched.filter((t=>t!=e)))),this.initialScheduleCheck&&(this.schedule=null)},generateRefID(){let t="";for(let e=0;e<6;e++)t+=Math.floor(9*Math.random());this.refID=t.toUpperCase()},async createSource(){const t=location.origin;try{await this.client.source.create({type:"gcash",currency:"PHP",amount:parseInt(`${this.paymentAmount}00`),redirect:{success:`${t}/payment-status`,failed:`${t}/payment-status`}}).then((t=>{this.checkoutUrl=t.data.attributes.redirect.checkout_url,xt.Z.commit("paymentID",t.data.id)})),this.checkoutUrl&&window.location.replace(this.checkoutUrl)}catch(e){this.isLoading=!1,this.errMsg=e}},reloadPage(){location.reload()}}},Ft=i(3744);const Ut=(0,Ft.Z)(Lt,[["render",At],["__scopeId","data-v-55cdaea8"]]);var Tt=Ut}}]);
//# sourceMappingURL=834.0b2733c1.js.map